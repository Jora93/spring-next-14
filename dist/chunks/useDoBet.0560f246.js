var Je=Object.defineProperty,je=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Be=(n,i,t)=>i in n?Je(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t,Q=(n,i)=>{for(var t in i||(i={}))ze.call(i,t)&&Be(n,t,i[t]);if(ge)for(var t of ge(i))Qe.call(i,t)&&Be(n,t,i[t]);return n},W=(n,i)=>je(n,qe(i));var X=(n,i,t)=>new Promise((B,E)=>{var S=d=>{try{f(t.next(d))}catch(l){E(l)}},C=d=>{try{f(t.throw(d))}catch(l){E(l)}},f=d=>d.done?B(d.value):Promise.resolve(d.value).then(S,C);f((t=t.apply(n,i)).next())});import{aI as Z,aJ as ee,E as Te,B as We,s as Xe,m as Ze}from"./backend-status-codes.80bfe624.js";import{useCallback as Ne}from"react";import{S as h,n as U,a1 as te,a2 as se,G as y,K as Ce,w as et,i as tt,$ as st,a0 as nt}from"./index.053dea56.js";import{j as ve,ah as ot,ai as at,ae as ne,ag as it,a5 as Ie,aj as Oe,ak as rt,al as he,am as K,an as oe,ao as ct,ap as ut,aq as Ae,ar as lt,as as dt}from"./index.c0392060.js";import{C as Le,c as R,L as H,s as x,E as Et,b as w}from"./swarm-command-names.230156ba.js";import{b as ft,e as ye,f as ae,r as ie,g as mt}from"./usePredefinedStakes.58f7290f.js";import{c as be}from"./editBetActions.91db0d9c.js";import{g as pt}from"./getAdvancedMultipleGeneralField.a271e2a8.js";import{l as ke,k as Pe,b as Ue,m as _t,n as St,o as gt,p as Bt,q as Tt,r as Ct,s as vt,t as It,u as Ot,v as ht,w as At,i as Lt,j as yt,x as bt,y as Nt,z as kt}from"./index.59a19261.js";import{g as we}from"./socket.c077606d.js";import{g as Pt,a as Fe}from"./user-data.f480309c.js";import{u as a}from"./index.ffa75b49.js";import"./i18next.083d61f0.js";import{u as Me}from"./useTranslation.70287e96.js";import{u as De}from"./useDispatch.cd750ed9.js";import{b as re}from"./batch.dcd71b53.js";import{s as Ut}from"./counterOffer.671956cb.js";const wt={ukBetSource:"136132"},Ft=()=>{const n=a(we),i=a(Pt),t=a(Fe),B=a(ke),E=a(Pe),S=a(Ue);return!i||!(E!=null&&E.length)||!n||B===1||S!=null&&S.active||h.SUPER_BET_DEFAULT_ON?!1:t.is_super_bet_available&&!E.some(({isLive:C,game_info:f})=>(C?!n.is_superbet_on_live:!n.is_superbet_on_prematch)||f&&Object.prototype.hasOwnProperty.call(f,"virtual"))},Mt=()=>{const n=De(),{t:i}=Me(),t=a(Fe),B=()=>new Promise((d,l)=>{navigator.permissions.query({name:"geolocation"}).then(s=>{s.state==="granted"?E().then(r=>{d(r)}).catch(()=>{l()}):s.state==="prompt"?navigator.geolocation.getCurrentPosition(()=>{E().then(r=>{d(r)}).catch(()=>{l()})},()=>{l(i("account.allowLocation"))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3}):s.state==="denied"&&l(i("account.allowLocation"))})}),E=()=>X(void 0,null,function*(){const d=yield S();return new Promise((l,s)=>{d?l(d):s()})}),S=()=>X(void 0,null,function*(){return new Promise((d,l)=>{ve(Le.GET_GEO_COMPLY_LICENSE_STRING,{},s=>{s.result===0&&s.details.LicenseString?d(s.details.LicenseString):l()},null)})}),C=()=>new Promise((d,l)=>{f("check").then(s=>{ve(Le.GEO_COMPLY_GEOLOCATION_CHECK,{location_token:s},r=>{r.result===0&&r.details.IsSuccess&&d()},null,()=>{n(Z(!1)),n(ee(null)),l()})}).catch(s=>{n(Z(!0)),n(ee(s)),l(s)})}),f=Ne((d,l)=>{const s=l||t.username||t.email||t.phone;return new Promise((r,F)=>{B().then(v=>{const _=window==null?void 0:window.GcHtml5.createClient();_.events.on("success",function(I){r(I)}).on("failed",function(I,D){F({code:I,message:D})}),_.setLicense(`${v}`),_.setUserId(s||""),_.setReason(d),_.request()}).catch(v=>{v&&(n(Z(!0)),n(ee(v)),v&&F(v))})})},[t.username,t.email,t.phone]);return{checkActionAllowed:f,geoComplyLocationCheck:C}},ns=({currentType:n,setAcceptBet:i,setSelected:t,toggleBetslipView:B,betslipRef:E,totalSingleWin:S,totalStake:C,setShouldValidateRecaptchaV3:f})=>{const{predefinedStakes:d}=ft(),l=a(_t),s=a(St),r=De(),F=a(we),v=a(gt),_=a(Pe),I=a(Ue),D=a(Bt),ce=a(ke),Re=a(Tt),ue=a(Ct),Ge=a(vt),le=a(It),de=a(Ot),Ve=a(ht),{singleEventsCalculations:G,general:A}=a(At),Ee=a(Lt),Ye=a(yt),{selectedFreeBetEventId:b,selectedFreeBetId:O}=a(bt),V=a(Nt),$=a(kt),{t:fe}=Me(),Ke=Ft(),{doBetHandler:J}=Dt(),k=e=>{r(at(e))},j=()=>{r(mt(!0))},q=(e,c)=>{if(c.result===We.betslip.useSuperBet){const p=Ae[c.result]?fe(Ae[c.result]):c.result_text||c.StatusCode||"",T=lt(p,c);if(T){const g=`${T} ${Ke?`<span style="text-decoration: underline">${fe("swarm.useSuperBet")}</span>`:""}`;Xe(g,null,null,()=>{Ze.destroy(g),Ee.some(u=>u==e)||K({id:e,superBet:!0}),tt()&&r(dt(!0))},{cursor:"pointer"})}}},me=(e,c,p)=>{const T=e.every(({tag:m})=>!!m),g=e[0].eventId,u=(()=>{var Se;const m=Ye.some(M=>M==g)&&e.length===1,N=Ee.some(M=>g==M||M===y),Y=h.SUPER_BET_DEFAULT_ON&&e.every(({isLive:M})=>!M),xe=h.SUPER_BET_DEFAULT_ON&&(F==null?void 0:F.is_superbet_on_live),$e=N||Y||xe;return m?st:$e?nt:Number((Se=JSON.parse(H.getItem(x("betslip","ACCEPT_BET"))))==null?void 0:Se.value)})(),P=(()=>{var N;return V&&O&&$?$:n!==U.SINGLE?(A==null?void 0:A.finalStake)||0:e[0].eventId&&((N=G[e[0].eventId])==null?void 0:N.finalStake)||0})(),o=e.map(m=>W(Q({event_id:Number(m.eventId),price:m.sp?te:Number(m.coeficient)},T?{tag:m.tag}:{}),{booking_id:m.booking_id})),L={amount:P,bets:o,type:c,mode:u,source:String(h.SOURCE)};return V&&O&&(L.bonus_id=O),c===w.SYSTEM&&(L.sys_bet=v==null?void 0:v.value),p&&(L.each_way=p),le&&(L.booking_id=Number(le)),s&&(c===w.SINGLE||c===w.MULTIPLE)&&(L.bonus_id=s.id),L},pe=()=>{_.forEach(e=>{var c,p;if(!(b&&e.eventId!==b)&&(((p=(c=G[e.eventId])==null?void 0:c.finalStake)!=null?p:d.default_stake)||I!=null&&I.amount||b)){const T=G[e.eventId]&&"oddOffer"in G[e.eventId],g=W(Q({},me([{eventId:Number(e.eventId),coeficient:e.sp?te:T?Ge[`odd${e.eventId}`]:Number(e.coeficient),tag:e.tag,isLive:e.isLive,booking_id:e.booking_id}],w.SINGLE)),{each_way:e.each_way});J(g,u=>{var o;const{result:P}=u||{};k(!1),P==="OK"&&(r(ne()),s&&r(re(ie({id:g.bonus_id,eventId:e.eventId}),ae(null))),h.AFTER_SUCCESSFUL_BET===se.REMOVE_EVENTS&&(j(),it(e.eventId)),V&&O&&r(Ie(O)),H.removeItem(x("betslip","EDIT_BET_ACTIVE")),Oe().bets.length===0&&B(!1),be(),(o=u.details)!=null&&o.is_superbet&&(T?(r(rt(Re+1)),r(Ut(!0))):r(he(ue+1))),K({id:y,stake:""}),K({id:e.eventId,stake:""}),t(""))},u=>{k(!1),u.data&&u.data.result===Te&&i(!0),q(e.eventId,u),u!=null&&u.StatusCode&&h.REMOVE_SUSPENDED_SELECTION&&Et.includes(u.StatusCode)&&oe()},i,document.getElementById("betslip-wrapper")||E.current)}})},z=e=>{if(Number(A==null?void 0:A.finalStake)||O||I!=null&&I.amount){const c=!!(A!=null&&A.isEachWay);J(me(_,e,c),p=>{var g;const{result:T}=p;k(!1),T==="OK"&&(be(),r(ne()),h.AFTER_SUCCESSFUL_BET===se.REMOVE_EVENTS&&(j(),oe()),H.removeItem(x("betslip","EDIT_BET_ACTIVE")),(g=p.details)!=null&&g.is_superbet&&r(he(ue+1)),V&&O&&r(Ie(O)),s&&r(re(ie({id:s.id,eventId:y}),ae(null))),Oe().bets.length===0&&B(!1),K({id:y,stake:""}),ct("",Object.keys(l)),t(""))},p=>{k(!1),q(ut(Ve),p)},i,document.getElementById("betslip-wrapper")||E.current)}},He=()=>{const e=Object.keys(l.single).length,c=e>0&&e<_.length,p=l.general||Object.values(l.single).find(o=>Number(o)>0);(c||parseFloat(p||"0")>0||S>0&&C>0||b&&b!==y)&&(de!==Ce.QUICKBET||_.length===1)&&pe();const T=h.SUPER_BET_DEFAULT_ON?-1:Number(JSON.parse(H.getItem(x("betslip","ACCEPT_BET"))).value),u={bets:_.map(o=>({event_id:Number(o.eventId),price:o.sp?te:Number(o.coeficient),booking_id:o.booking_id})),mode:T,amount:0,type:2,sys_bet:0,each_way:!1};let P=structuredClone(D);de===Ce.QUICKBET&&(P=P.filter(o=>o.count===_.length&&!o.strongCount&&o.type!==1)),P.map(o=>{var L;(o.amount>0&&o.type!==1||b===y&&o.combCount===1)&&(u.amount=o.each_way?+o.amount*2:b===y?$||0:o.amount,u.sys_bet=Number(o.sys_bet),u.type=o.type,u.each_way=o.each_way,u.source=wt.ukBetSource,b===y&&O&&(u.bonus_id=O),o.count===_.length&&ce===et.ADVANCED&&(s!=null&&s.boost_max_bet_amounts)&&u.amount<=((L=s==null?void 0:s.boost_max_bet_amounts)==null?void 0:L.MaxBetAmount)&&(u.bonus_id=s.id),J(u,m=>{const{result:N}=m;k(!1),N==="OK"&&(r(ne()),s&&r(re(ie({id:s.id,eventId:y}),ae(null))),h.AFTER_SUCCESSFUL_BET===se.REMOVE_EVENTS&&(j(),oe()),_e()),t("")},m=>{var Y;const N=pt(o)?U.MULTIPLE:U.SYSTEM;k(!1),q(N,m),((Y=m.data)==null?void 0:Y.result)===Te&&i(!0)},void 0,document.getElementById("betslip-wrapper")||E.current))})},_e=Ne(()=>{let e=[];e=JSON.parse(JSON.stringify(D)),e.map(c=>{c.active=!1,c.stake="",c.amount=0,c.each_way=!1,c.name==="Single"&&(c.combCount=1)}),r(ot(e))},[D]);return{clearUkTypes:_e,onPlaceBet:()=>{if(i(!1),k(!0),f(!1),ce===0)switch(R[n]){case R[U.SINGLE]:pe();break;case R[U.MULTIPLE]:z(w.MULTIPLE);break;case R[U.CHAIN]:z(w.CHAIN);break;case R[U.SYSTEM]:z(w.SYSTEM)}else He()}}},Dt=()=>{const{checkActionAllowed:n}=Mt();return{doBetHandler:(t,B,E,S,C)=>{if(h.GEO_COMPLY_ENABLED){n("do_bet").then(f=>{t.location_token=f,ye(t,B,E,S,C)}).catch(f=>{E&&E({data:{result:0},StatusCode:"0"}),console.info(f)});return}else ye(t,B,E,S,C)}}};export{Ft as a,ns as b,Dt as u};
