var Y=Object.defineProperty,Z=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var H=(e,t,a)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,r=(e,t)=>{for(var a in t||(t={}))X.call(t,a)&&H(e,a,t[a]);if(j)for(var a of j(t))ee.call(t,a)&&H(e,a,t[a]);return e},C=(e,t)=>Z(e,k(t));import{createContext as te,useContext as ae,useCallback as ne}from"react";import{C as V}from"./custom-categories.700b2888.js";import{f as Q,m as O,e as ie,b as se,d as oe}from"./route-manipulation.7a3d02e7.js";import{c as s,bM as f,bN as U,bO as x}from"./index.2e7649fa.js";import{b as re,S as c,i as ce,I as _}from"./index.9a33d21b.js";import{L as v,s as D}from"./swarm-command-names.afa48e3f.js";import{s as h,a as z}from"./index.1dfc2dcd.js";import{U as de,c as me,d as b,e as ue,f as P,g as pe}from"./new-casino.c45049f4.js";import{g as he}from"./game-url.afce1e8e.js";import{b as B,A as q}from"./index.c7348bcc.js";import{b as M}from"./batch.dcd71b53.js";import{g as fe}from"./casino-data.e9191b01.js";import"./backend-status-codes.4c1943df.js";import"./i18next.083d61f0.js";import{u as Ie}from"./useSearchParams.353231ec.js";import{u as le}from"./useSbRouteMatch.ecfb9430.js";const _e=e=>{var i;return!!((i=s.getState().newCasinoStore.cachedGames[e])!=null&&i.data)},ge=()=>{const e=s.getState().userData,t=JSON.parse(v.getItem(D("account","AUTH_DATA")));return t!=null&&t.auth_token?!0:e.isLoggedIn},w=re(),Se=({routeToSaveInStorage:e,query:t={}}={})=>{h("login",e),w.push(z(r({accounts:"*",login:"*"},t)))},F={openLoginView:Se,checkIsUserLoggedIn:ge},W="enabled",T=300,Ce=({game:e,mode:t,view:a=U.SINGLE,selectedCategory:i,tournament:n,gameIndexToChange:I,queriesToRemove:l})=>{const E=()=>{window.open(he({gameId:e.extearnal_game_id,gameType:t,gameOptions:e.game_options}),"_self")},R=g=>new Promise(m=>{var L;if(!g&&v.setItem(D("casino","GAMES_FETCHED"),"true"),a===U.SINGLE){const u=`${c.DECENTRALIZED_CASINO_URL?e.cats[0]:((L=e.cats[0])==null?void 0:L.id)||de}`,$=`${Q(e.provider_title)}`,G=`${e.id}-${e.extearnal_game_id}-${Q(e.name)}`,N=i||V.all.id,p=_.parse(window.location.search,{ignoreQueryPrefix:!0}),y=(l||[]).reduce((A,K)=>(A[K]=void 0,A),{}),o=[N,u,$,G];if(g&&window.hasPopup){const A=JSON.stringify({pathname:`${O(window.getPathname(),!1,!0)}/${o.join("/")}`,search:_.stringify(r(C(r({},p),{mode:t,accounts:void 0,login:void 0,tournamentId:n==null?void 0:n.id}),y))});v.setItem(D("casino","SELECTED_GAME_URL"),A);return}const S=ie();if(S&&S!=="casino"){se(`${c.PAGE_URLS.casino}/${c.CASINO_MOUNT_PATH}/${o.join("/")}?mode=${t}`,!1,!0),h(),setTimeout(()=>{m(!0)},T);return}if(s.dispatch(fe(e)),s.dispatch(me(e.extearnal_game_id)),s.dispatch(M(ue(e.extearnal_game_id),b(e))),s.dispatch(P({id:e.extearnal_game_id,mode:t})),window.location.pathname.includes(`/${c.SPORTSBOOK_MOUNT_PATH}/`)){w.push({pathname:`${O(window.getPathname(),!1,!0).replace(`/${c.CASINO_MOUNT_PATH}`,"")}`,search:_.stringify(r({gameId:e.extearnal_game_id,mode:t,accounts:void 0,login:void 0},!!p.type&&{type:p.type}))}),h(),setTimeout(()=>{m(!0)},T);return}w.push({pathname:`${O(window.getPathname(),!1,!0)}/${o.join("/")}`,search:_.stringify(r(C(r({},p),{mode:t,accounts:void 0,login:void 0,tournamentId:n==null?void 0:n.id}),y))}),h(),setTimeout(()=>{m(!0)},T);return}if(a===U.MULTI){const u=Object.fromEntries(new URLSearchParams(window.location.search));if(u.multiview===W){const o=d.extractGameInfoFromSearchParams(u)[I||0];s.dispatch(M(pe(o.id),b(e))),s.dispatch(M(P({id:e.extearnal_game_id,mode:t}),P({id:o.id,mode:f.FUN})));const S=z({[d.encodeGameIdWithPrefix(o.order,o.id)]:void 0,[d.encodeGameIdWithPrefix(o.order,e.extearnal_game_id)]:t});w.push(C(r({},S),{search:d.normalizeStringifiedQuery(S.search)})),h(),setTimeout(()=>{m(!0)},T);return}const $=oe(),G=i||V.all.id,N=_.parse(window.location.search,{ignoreQueryPrefix:!0});s.dispatch(b(e)),s.dispatch(P({id:e.extearnal_game_id,mode:t}));let p=`${O(window.getPathname(),!1,!0)}/${G}`;window.location.pathname.includes(`/${c.SPORTSBOOK_MOUNT_PATH}/`)&&(delete N.gameId,p=p.replace(`/${c.CASINO_MOUNT_PATH}/${G}`,"")),w.push({pathname:p,search:d.normalizeStringifiedQuery(_.stringify(C(r({},N),{multiview:W,[d.encodeGameIdWithPrefix(x.FIRST,$.gameExternalId)]:u.mode,[d.encodeGameIdWithPrefix(x.SECOND,e.extearnal_game_id)]:t,accounts:void 0,login:void 0,mode:void 0}),{addQueryPrefix:!0}))}),h(),setTimeout(()=>{m(!0)},T)}}),J=F.checkIsUserLoggedIn();if(t===f.REAL&&!J){window.hasPopup&&R(!0);const g=Object.fromEntries(new URLSearchParams(window.location.search));let m={mode:t};if(g.multiview===W)for(const u in g)u.indexOf(e.extearnal_game_id)>=0&&(m={[u]:t});F.openLoginView({query:m}),new B().appendAction(q.CONSTRUCT_CASINO_VIEW_URL,R);return}!c.CASINO_MOBILE_IFRAME&&ce()?E():R()},Te=(e,t)=>`${e}-${t}`,Oe=e=>{const[t,a]=e.split("-");return{order:parseInt(t),gameId:a}},we=e=>Object.entries(e).reduce((a,[i,n])=>{if(n&&[f.REAL,f.FUN].includes(n)){const{order:I,gameId:l}=d.decodeGameIdWithPrefix(i);!Number.isNaN(I)&&!Number.isNaN(l)&&a.push({id:`${l}`,mode:n,order:I})}return a},[]),Ee=()=>{var e,t;return(t=(e=window.getPathname().split(`/${c.CASINO_MOUNT_PATH}/`))==null?void 0:e[1])==null?void 0:t.split("/").length},Ge=e=>{const t=e.slice(1).split("&"),a=t.findIndex(n=>n.startsWith(`${x.FIRST}-`)&&(n.endsWith(`${f.FUN}`)||n.endsWith(`${f.REAL}`))),i=t.findIndex(n=>n.startsWith(`${x.SECOND}-`)&&(n.endsWith(`${f.FUN}`)||n.endsWith(`${f.REAL}`)));if(a<0&&i<0)return e;if(a>i){const n=t[a];t[a]=t[i],t[i]=n}return`?${t.join("&")}`},Ne=(e,t,a)=>{F.openLoginView({routeToSaveInStorage:t}),a?h(a,t):h(),new B().appendAction(q.RECONSTRUCT_CASINO_VIEW_URL,()=>new Promise(n=>{e==null||e(),n(!0)}))},d={checkIsGameAlreadyCached:_e,constructAndRedirectToGameView:Ce,reconstructAndRedirectToGameView:Ne,extractGameInfoFromSearchParams:we,encodeGameIdWithPrefix:Te,decodeGameIdWithPrefix:Oe,normalizeStringifiedQuery:Ge,getRouteLength:Ee},Ae=te({}),Pe=()=>ae(Ae),Be=()=>{const{tournamentId:e}=Ie(),t=Pe(),a=le(`${O(location.pathname,!1,!0)}/:category`);return ne((i,n)=>{var E;if(t.onOpenGame){t.onOpenGame(n,i);return}const I=((E=a==null?void 0:a.params)==null?void 0:E.category)||V.all.id,l=e?{id:e}:void 0;d.constructAndRedirectToGameView({game:n,mode:i,selectedCategory:I,view:U.SINGLE,tournament:l})},[e,a,e])};export{Be as u};
