var se=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var j=(a,o,n)=>o in a?se(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n,L=(a,o)=>{for(var n in o||(o={}))ie.call(o,n)&&j(a,n,o[n]);if(R)for(var n of R(o))re.call(o,n)&&j(a,n,o[n]);return a},x=(a,o)=>oe(a,ne(o));import{useId as ae,useState as M,useCallback as K,useEffect as ce}from"react";import{u as le,n as c,ap as de,G as me}from"./index.9a33d21b.js";import{aB as pe,bw as ue,c8 as ge,by as Be,c0 as Ie,bp as fe,am as $,bT as Ee,br as Se}from"./index.2e7649fa.js";import{n as S,b as g,k as he}from"./swarm-command-names.afa48e3f.js";import{ag as q,s as w}from"./backend-status-codes.4c1943df.js";import{K as h,L as be,x as ke}from"./usePredefinedStakes.892527de.js";import{a as _e}from"./index.1dfc2dcd.js";import{u as Te}from"./useBetlsipNotEmptyPopup.e8996772.js";import"./i18next.083d61f0.js";import{f as ye}from"./app-data.3313f084.js";import{m as Pe,k as Ne,o as Ae}from"./index.9e499441.js";import{g as Le}from"./spec-elems.a06c4bcb.js";import{g as Me}from"./user-data.358c1cdc.js";import{u as we}from"./useTranslation.70287e96.js";import{u as Ce}from"./useDispatch.151d3a82.js";import{u as m}from"./index.17630e7e.js";let C="";const We=({setBookingModalVisible:a,setBookIds:o,currentType:n,totalStake:Y,betslipRef:b,betslipUid:v})=>{const U=ae(),p=Ce(),k=m(Pe),d=m(ye),{showPopup:Q}=Te(),B=m(Me),_=m(Ne),I=m(Ae),V=m(Le),{t:G}=we(),H=le(),[u,z]=M(""),[J,T]=M(!1),[W,y]=M(!1),f=s=>{o(s),T(!1),a(!0)},E=()=>{o([]),T(!1),a(!1)},X=K(()=>{const s=t=>t===g.SINGLE?_.map(({eventId:e,coeficient:i})=>({Amount:Number(k.single[e])||0,BetType:t,Selections:[{SelectionId:e,Price:Number(i)}]})):t===S.TYPE?[{BetSlipUid:v,Amount:Number(Y)||0,BetType:S.TYPE}]:_.reduce((e,{eventId:i,coeficient:l})=>(e.length||e.push(L({Amount:Number(k.general||0),BetType:t,Selections:[]},t!==g.SYSTEM?{}:{SystemMinCount:I==null?void 0:I.value})),e[0].Selections&&e[0].Selections.push({SelectionId:i,Price:Number(l)}),e),[]),r=[];switch(T(!0),n){case c.SINGLE:s(g.SINGLE).forEach(t=>{r.push(new Promise(e=>{h([t],i=>{e({booking_id:i.details.Id,selection_id:t.Selections&&t.Selections[0].SelectionId})},E)}))}),Promise.all(r).then(t=>{f(t)});break;case c.CHAIN:case c.MULTIPLE:{const t=n===c.CHAIN?"CHAIN":"MULTIPLE";h(s(g[t]),e=>{f([{booking_id:e.details.Id}])},E)}break;case c.SYSTEM:h(s(g.SYSTEM),t=>{f([{booking_id:t.details.Id}])},E);break;case S.NAME:h(s(S.TYPE),t=>{f([{booking_id:t.details.Id}])},E);break}},[_,n,k,Y,I,v]);ce(()=>{if(C||(C=U),d.bookBetId&&B&&!window.mustRefreshForSessionVisibility&&C===U){V&&p(pe(!0)),P(d.bookBetId);const s=Object.assign({},d);delete s.bookBetId,p(q(s))}},[B,d.bookBetId]);const Z=K(()=>{B?P():(H.push(_e({accounts:"*",login:"*"})),p(q(x(L({},d),{bookBetId:u}))))},[u,B,d]),P=(s=null)=>{y(!0),be(s||u,r=>{var e;if(y(!1),typeof r.details=="string"||!Object.keys(r.details).length){w(G("betslip.wrongBookId"),b.current);return}const t=(e=r.details.bets[0].selections)==null?void 0:e.map(({match_id:i,selection_id:l})=>({gameId:i,eventId:l}));ke(t,i=>{if(!Object.keys(i.data.sport).length){w(G("betslip.bookIdExpired"),b.current);return}ue()?F(r,i.data,t.length):Q(()=>{F(r,i.data,t.length)})})},r=>{w(r.data||r.msg,b.current),y(!1)})},F=(s,r,t)=>{const e=ge(r);if(s.details.match_ids&&s.details.bets[0].bet_type===c.CHAIN){const D=e.splice(0,e.length);s.details.match_ids.forEach(ee=>{const O=D.find(({gameId:te})=>te===ee);O&&e.push(O)})}const{bets:[{system_min_count:i}],bets:[{amount:l}],bets:[{bet_type:N}]}=s.details;Be(e,!0),e.length===s.details.match_ids.length&&i&&p(Ie(i)),N===c.SYSTEM&&e.length<de||[c.MULTIPLE,c.CHAIN].includes(N)&&e.length<2||fe(he[N]),l&&($({id:me,stake:`${l}`}),e.length===1&&$({id:e[0].eventId,stake:`${l}`})),p(Ee(!1)),t===e.length&&Se(u);const A=new URLSearchParams(window.location.search);A.has("booking_id")&&(A.delete("booking_id"),H.replace({search:A.toString()}))};return{bookId:u,setBookId:z,bookingProgress:J,getByBookIdProgress:W,onBookBet:X,onSubmitBookId:Z,getEvents:P}};export{We as u};
