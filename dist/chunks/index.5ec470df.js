import{S as D,ab as n,j as l}from"./index.053dea56.js";import{useState as g,useEffect as E,Suspense as I}from"react";import{s as q}from"./styled-components.browser.esm.22f548e7.js";import{R as z,p as J,bc as K}from"./index.c0392060.js";import{C as Q}from"./swarm-command-names.230156ba.js";import{G as X}from"./global-variables.eb46f49b.js";import{C as Y}from"./index.9fa2e41e.js";import{M as Z}from"./index.ee65228f.js";import{u as F}from"./useMounted.6d9c5610.js";import{q as R,r as S}from"./app-data.da3833f4.js";import{u as L}from"./index.ffa75b49.js";import"react-dom";import"./backend-status-codes.80bfe624.js";import"./i18next.083d61f0.js";import"./index.fbd937ed.js";import"./index.184af16c.js";import"./usePopupScrollDisable.77ea6409.js";import"./useSearchParams.0c3b0efc.js";import"./index.59a19261.js";import"./user-data.f480309c.js";import"./v4.751847df.js";import"./useDispatch.cd750ed9.js";import"./create-test-id.17a0abc8.js";import"./create-fake-array.68114bc4.js";const T=q.div`
  margin-top: 20px;
  margin-bottom: 10px;
  width: 304px;
  ${p=>p.error&&` border: 1px solid red;
      height: 78px;
      border-radius: 5px;
  `}
`,Ar=({action:p="login",onSetRecaptchaToken:s,needRecaptchaVerify:x,shouldValidate:C,error:U=!1,shouldValidatev2:A,setRecaptchaExpired:V,hasV2:B,verifyRecaptchaFallbackKey:o,extraClass:M="",wrapV2InModal:H})=>{const w=window.grecaptcha,t=L(R),c=L(S),{mounted:_}=F(),W=D.CURRENT_LANGUAGE.slice(0,2)||"en",[$,G]=g(""),[f,y]=g(""),[m,h]=g(!1),[N,b]=g(!1),[i,j]=g(null);E(()=>{if(t&&(c||f)&&!w){const r=t===n.V2||o?`https://www.google.com/recaptcha/api.js?render=explicit&hl=${W}`:`https://www.recaptcha.net/recaptcha/api.js?render=${c||f}`;v(r,t,()=>{_.current&&b(!0)})}w&&(j(w),b(!0))},[t,c,f,i,p,C,A]),E(()=>{if(N&&i&&(t===n.V2||m||o)){window.handleRecaptcha=a=>{s==null||s(a)};const r=o||(m?f:c);i&&r&&i.ready(()=>{i.render(`recaptcha-key-${t}`,{sitekey:r,callback:()=>O(),"expired-callback":()=>{s&&(s==null||s("")),V&&V(!0)}})})}},[N,i,m,f,w]),E(()=>{C&&(t===n.V3?!m&&i&&i.ready(()=>{i.execute(c,{action:p}).then(r=>{_.current&&(G(r),P(r))})}):O())},[C,i]);const v=(r,a,d)=>{const e=document.getElementById(`captcha-${a}`);if(e)j(window.grecaptcha);else{const u=document.createElement("script");u.type="text/javascript",u.src=r,u.id=`captcha-${a}`,u.onload=function(){j(window.grecaptcha),d&&d()},document.body.appendChild(u)}e&&d&&d()},O=()=>{if(i)try{const r=i.getResponse();r&&(G(r),s&&(s==null||s(r))),(m||o)&&P(r)}catch(r){t===n.V2&&s&&(s==null||s())}},P=r=>{const a={command:Q.VALIDATE_RECAPTCHA,params:{action:p,g_recaptcha_response:r,version:m||o?"v2":`v${t}`},rid:z.gForCommand()};J.then(d=>d.sendCommand(a,"",e=>{typeof e!="string"&&typeof e.result=="boolean"?(p==="register"&&(X.account.registration.isRecaptchaVerify=!0),h(!1),y(""),x&&x(!1),s&&(s==null||s($||r))):e&&typeof e=="string"&&(h(!0),x&&x(!0),y(e))},null,e=>{e.code===K[27]&&(h(!0),y(e.data))}))};return B&&t!==n.V3||m||A?l.jsx(Y,{condition:!!H,wrapper:r=>l.jsx(I,{children:l.jsx(Z,{visible:!0,closable:!1,className:"doBetRecaptchaModal",centered:!0,children:r})}),children:l.jsx(T,{error:U,className:`${M} g-recaptcha`,"data-sitekey":m?f:c,"data-callback":"handleRecaptcha",children:l.jsx("form",{action:"?",method:"POST",className:"google_recaptcha",children:l.jsx("div",{id:`recaptcha-key-${t}`,className:"g-recaptcha"})})})}):null};export{Ar as Recaptcha,T as RecaptchaContainer};
